\section{Лекция 2}

\subsection{Формализация $\lambda$-термов, классы $\alpha$-эквивалентности термов}

\begin{definition}[$\lambda$-терм]
	Рассмотрим классы эквивалентности $[A]={\alpha}$ \\
	Будем говорить, что $[A]\to_{\beta}[B]$, если $\exists A^{'}\in [A], B^{'} \in [B]$, что $A^{'}\to_{\beta}B^{'}$.
\end{definition}

\begin{lemma}
	$=_{\alpha}$ "--- отношение эквивалентности.
\end{lemma}

Пусть в A есть $\beta$-редекc $\lambda{}x.Q$, но $P[x\coloneqq{}Q]$ не может быть,
тогда найдем $y\notin V[P]$, $y\notin V[Q]$. Сделаем замену $P[x\coloneqq{}y]$.
Тогда замена $P[x\coloneqq{}y][y\coloneqq{}Q]$ допустима.

\begin{lemma}
	$P[x\coloneqq{}y]=_{\alpha}P[x\coloneqq{}y][y\coloneqq{}Q]$, если замена допустима.
\end{lemma}

\subsection{Нормальная форма, $\lambda$-выражения без нормальной формы, комбинаторы $K$, $I$, $\Omega$}

\begin{definition}
	Нормальня форма "--- это $\lambda$-выражение без $\beta$-редексов.
\end{definition}

\begin{lemma}
	$\lambda$-выражение $A$ в нормальноф форме, т.и.т.т, когда $\nexists{}B$, что $A\to_{\beta}B$.
\end{lemma}

\begin{definition}
	$A$ "--- Н.Ф $B$, если $\exists A_{1}...A_{n}$, что $B=_{\alpha}A_{1}\to_{\beta}A_{2}\to_{\beta}...\to_{\beta}A_{n}=_{\alpha}A$.
\end{definition}

\begin{definition}
	Комбинатор "--- $\lambda$-выражение без свободных переменных.
\end{definition}

\begin{definition} 
	\hfill
	\begin{itemize}
		\item $I=\lambda{}x.x$ (Identitant)
		\item $K=\lambda{}a.\lambda{}b.a$ (Konstanz)
		\item $\Omega = (\lambda{}x.xx)(\lambda{}x.xx)$
	\end{itemize}
\end{definition}

\begin{lemma}
	$\Omega$ "--- не имеет нормальной формы.
\end{lemma}

\begin{proof}
	$\Omega\to_{\beta}\Omega$
\end{proof}

\subsection{$\beta$-редуцируемость}

\begin{definition}
	Будем говорить, что $A\twoheadrightarrow_{\beta}B$, если $\exists$ такие $X_{1}..X{n}$, что $A=_{\alpha}X_{1}\to_{\beta}X_{2}\to_{\beta}...\to_{\beta}X_{n-1}\to_{\beta}X_{n}=_{\alpha}B$.
\end{definition}

$\twoheadrightarrow_{\beta}$ "--- рефлексивное и транзитивное замыкание $\to_{\beta}$. $\twoheadrightarrow_{\beta}$ не обязательно приводит к нормальной форме
\begin{example}
	$\Omega\twoheadrightarrow_{\beta}\Omega$
\end{example}

\subsection{Ромбовидное свойство}

\begin{definition}[Ромбовидное свойство]
	Отношение $R$ обладает ромбовидным свойством, если $\forall a,b,c$, таких, что $aRb$, $aRc$, $b\neq{}c$, $\exists{}d$, что $bRd$ и $cRd$. Далее будем обозначать ромбовидное свойство как $<>$.
\end{definition}

\begin{example}
	$(\leq)$ на множестве натуральных чисел обладает $<>$
	$(>)$ не обладает $<>$ на множестве натуральных чисел 
\end{example}

\subsection{Теорема Чёрча-Россер, следствие о единственности нормальной формы}

\begin{theorem}[Черча-Россера]
	$(\twoheadrightarrow_{\beta})$ обладает ромбовидным свойством.
\end{theorem}


\begin{cons}
	Если у $A$ есть Н.Ф, то она единтсвенная с точностью до $(=_{\alpha})$ (переименования переменных).
\end{cons}

\begin{proof}
	Пусть $A\twoheadrightarrow_{\beta}B$ и $A\twoheadrightarrow_{\beta}C$. $B$, $C$ "--- нормальные формы и $B\neq_{\alpha}C$. 
	Тогда по теореме Черча-Россера $\exists{}D$: $B\twoheadrightarrow_{\beta}D$ и $C\twoheadrightarrow_{\beta}D$. Тогда $B=_{\alpha}D$ и $C=_{\alpha} D$ $\Rightarrow$ $B=_{\alpha}C$. Противоречие.
\end{proof}

\begin{lemma}
	Если $B$ "--- Н.Ф, то $\nexists{}Q$: $B\to_{\beta}Q$. Значит если $B\twoheadrightarrow_{\beta}Q$, то количество шагов редукции равно 0.
\end{lemma}

\begin{lemma}
	 \label{refl}
	Если $R$ "--- обладает $<>$, то и $R^{*}$ (транзитивное, рефлексивное замыкание $R$) обладает $R^{*}$.
\end{lemma}

\begin{proof}
    Пусть $M_1 R^{*} M_n$ и $M_1 R N_1$. Тогда существуют такие $M_2 \ldots M_{n-1}$, что $M_1 R M_2$ \ldots $M_{n-1} R M_n$.
	Так как $R$ обладает ромбовидным свойством, $M_1 R M_2$ и $M_1 R N_1$, то существует такое $N_2$,
	что $N_1 R N_2$ и $M_2 R N_2$. Аналогично, существуют такие $N_3 \ldots N_n$, что $N_{i-1} R N_{i}$ и $M_i R N_i$.
	Мы получили такое $N_n$, что $N_1 R^{*} N_n$ и $M_n R^{*} N_n$.
	
	Пусть теперь $M_{1,1}R^{*}M_{1,n}$ и $M_{1,1}R^{*}M_{m,1}$, то есть имеются $M_{1,2}$\ldots$M_{1,n-1}$ и $M_{2,1}$\ldots$M_{m-1,1}$,
	что $M_{1,i-1} R M_{1,i}$ и $M_{i-1, 1} R M_{i, 1}$.
	Тогда существует такое $M_{2,n}$, что $M_{2,1} R^{*} M_{2,n}$ и $M_{1,n} R^{*} M_{2,n}$.
	Аналогично, существуют такие $M_{3,n}\ldots M_{m,n}$, что $M_{i,1} R^{*} M_{i,n}$ и $M_{1,n} R^{*} M_{i,n}$.
	Тогда $M_{1,n} R^{*} M_{m,n}$ и $M_{m,1} R^{*} M_{m,n}$.
\end{proof}

\begin{lemma}[Грустная лемма]
	$(\to_{\beta})$ не обладает $<>$
\end{lemma}

\begin{proof}
	Пусть $A=(\lambda{}x.x.x)(\comb I \comb I)$. Покажем что в таком случае не будет выполнять сомбовидное свойство:
	\
	\begin{figure}[ht]
		\centering
		\begin{tikzpicture}[->, every edge/.style={draw=black,thick}]
		\node[label={\scriptsize\tikz\node[circle,draw]{$A$};}]     at (0,   0) (A)  {$(\lambda x . x x)(\comb I \comb I)$};
		\node[label={135:\scriptsize\tikz\node[circle,draw]{$B$};}] at (-2, -1) (B)  {$(\comb I \comb I)(\comb I \comb I)$};
		\node[label={45:\scriptsize\tikz\node[circle,draw]{$C$};}]  at (2,  -1) (C)  {$(\lambda x . x x)  \comb I$};
		\node                                                       at (-3, -2) (B1) {$(\comb I \comb I)\comb I$};
		\node                                                       at (-1, -2) (B2) {$\comb I(\comb I \comb I)$};
		\node                                                       at (0,  -3) (D)  {$\comb I \comb I$};
		\path (A)  edge (B)
		edge (C)
		(B)  edge (B1)
		edge (B2)
		(B1) edge (D)
		(B2) edge (D)
		(C)  edge (D);
		\end{tikzpicture}
		\caption{Нет такого $D$, что $B \to_{\beta} D$ и $C \to_{\beta} D$.}
	\end{figure}	
\end{proof}


\newcommand{\bpar}{\rightrightarrows_{\beta}}

\begin{definition}[Параллельная $\beta$-редукция]
	$A\bpar B$, если
	\begin{enumerate}
		\item $A=_{\alpha}B$
		\item $A\equiv{}P_{1}Q_{1}$, $B\equiv{}P_{2}Q_{2}$ и $P_{1}\bpar P_{2}$, $Q_{1}\bpar Q_{2}$
		\item $A\equiv{}\lambda{}x.P_{1}$, $B\equiv{}\lambda{}x.P_{2}$ и 
		$P_{1}\bpar P_{2}$
		\item $A=_{\alpha}(\lambda{}x.P)Q$, $B=_{\alpha}P[x\coloneqq{}Q]$
	\end{enumerate}
\end{definition}

\begin{lemma}
	\label{bparhelp}
	$P_{1}\bpar P_{2}$ и $Q_{1}\bpar Q_{2}$, то $P_{1}[x\coloneqq{}Q_{1}]\bpar P_{2}[x\coloneqq{}Q2]$
\end{lemma}

\begin{proof}
	Будем доказывать индукцией по определению $\bpar $. Рассмотрим случаи:
	\begin{itemize}
		\item Пусть $P_{1}=_{\alpha}P_{2}$. Тогда лемма легко доказывается индукцией по структуре выражения.
		\item Пусть $P_{1}\equiv{}A_{1}B_{1}$, $P_{2}\equiv{}A_{2}B_{2}$. По определению $\bpar$ $A_{1} \bpar A_{2}$ и $B_{1} \bpar B_{2}$.
		Рассмотрим два случая:
		\begin{enumerate}
			\item $x \in \FV(A_{1})$. По индукционному предположению $A_{1}[x\coloneqq{}Q_{1}] \bpar A_{2}[x\coloneqq{}Q_{2}]$. Тогда $A_{1}[x\coloneqq{}Q_{1}]B_{1} \bpar A_{2}[x\coloneqq{}Q_{2}]B_{2}$. Тогда $A_{1}B_{1}[x\coloneqq{}Q_{1}] \bpar A_{2}B_{2}[x\coloneqq{}Q_{2}]$.
			\item Аналогично для $B$
		\end{enumerate}
		\item Пусть $P_{1}\equiv{}\lambda{}x.A_{1}$, $P_{2}\equiv{}\lambda{}x.A_{2}$. по определению $\bpar$ $A_{1}\bpar A_{2}$. Тогда по индукционному предположению $A_{1}[x'\coloneqq{}Q_{1}] \bpar A_{2}[x'\coloneqq{}Q_{2}]$. Тогда 
		$\lambda{}x.(A_{1}[x'\coloneqq{}Q_{1}]) \bpar \lambda{}x.(A_{2}[x'\coloneqq{}Q_{2}])$ по определению $\bpar$. Следовательно 	$\lambda{}x.A_{1}[x'\coloneqq{}Q_{1}] \bpar \lambda{}x.A_{2}[x'\coloneqq{}Q_{2}]$ по определению подствановки.
		\item Пусть $P_{1}\equiv(\lambda{}x.A)B$, $P_{2}\equiv A[x\coloneqq{}B]$. Тогда по индукционному предположению $A[x\coloneq{}Q_{1}] \bpar A[x\coloneqq{}Q_{2}], B[x\coloneq{}Q_{1}] \bpar B[x\coloneqq{}Q_{2}]$. Тогда по определению $\bpar$ имеем $(\lambda{}x.A[x'\coloneqq{}Q_1])B \bpar A[x'\coloneqq{}Q_2][x\coloneqq{}B]$. Тогда имеем, что $A[x'\coloneqq{}Q_1][x\coloneqq{}B] \equiv (A[x\coloneqq{}B])[x'\coloneqq{}Q_2] \equiv B[x'\coloneqq{}Q_{2}]$.
	\end{itemize}
\end{proof}

\begin{lemma}
	$(\bpar )$ обладает $<>$
\end{lemma}

\begin{proof}
	Будем доказывать индукцией по определению $\bpar$. Покажем, что если $M \bpar M_1$ и $M \bpar M_2$, то $\exists{}M_3$, что $M_1 \bpar M_3$ и $M_2 \bpar M_3$. Рассмотрим случаи:
	\begin{itemize}
		\item Если $M\equiv M_1$, то просто возьмем $M_3\equiv M_2$.
		\item Если $M\equiv \lambda{}x.P, M_1 \equiv \lambda{}x.P_1, M_2 \equiv \lambda{}x.P_2$ и $P \bpar P_1, P \bpar P_2$, то по предположению индукции 
		$\exists P_3$, что $P_1 \bpar P_3, P_2 \bpar P_3$, тогда возьмем $M_3\equiv \lambda{}x.P_3$.
		\item Если $M \equiv P Q, M_1 \equiv P_1 Q_1$ и по определению $\bpar$ $P \bpar P_1, Q \bpar Q_1$, то рассмотрим два случая:
		\begin{enumerate}
			\item $M_2 \equiv P_2 Q_2$. Тогда по предположению индукции $\exists P_3$, что $P_1 \bpar P_3, P_2 \bpar P_3$. Аналогично для $Q$. Тогда возьмем $M_3 \equiv P_3 Q_3$.
			
		\end{enumerate}
	\end{itemize}
\end{proof}

\begin{lemma}
	\
	\begin{enumerate}
		\item $(\bpar )^{*} \subseteq (\to_{\beta})^{*}$
		\item $(\to_{\beta})^{*} \subseteq (\bpar )^{*}$
	\end{enumerate}
\end{lemma}

\begin{cons}
	$(\to_{\beta})^{*}=(\bpar )^{*}$
\end{cons}

Из приведенных выше лемм и следствия докажем теорему Черча-Россера.

\begin{proof}
	$(\to_{\beta})^{*}\equiv(\twoheadrightarrow_{\beta})$. Тогда $(\twoheadrightarrow_{\beta})=(\bpar )^{*}$. Значит из того, что $(\bpar )$ обладает $<>$ и леммы $\ref{refl}$ следует, что $(\twoheadrightarrow_{\beta})$ обладает $<>$.
\end{proof}

\subsection{Нормальный и аппликативный порядок вычислений}

\begin{example}
	Выражение $KI\Omega$ можно редуцировать двумя способами:
	\begin{enumerate}
		\item $\comb K \comb I \Omega =_{\alpha} ((\lambda{}a.\lambda{}b.a) I) \Omega \to_{\beta} (\lambda{}b.\comb I)\Omega  \to_{\beta} \comb I$
		\item  $\comb K \comb I \Omega =_{\alpha} ((\lambda{}a.\lambda{}b.a) I)((\lambda{}x.x \ x) (\lambda{}x.x \ x)) \twoheadrightarrow_{\beta} ((\lambda{}a.\lambda{}b.a) I)((\lambda{}x.x \ x) (\lambda{}x.x \ x)) \to_{\beta} \comb K \comb I \Omega $
	\end{enumerate}
	
\end{example}

Как мы видим, в первом случае мы достигли нормальной формы, в то время как во втором мы получаем бесонечную редукцию. Разница двух этих способов в порядке редукции. Первый называется нормальный порядок, а второй аппликативный. 

\begin{definition}[нормальный порядок редукции]
	Редукция самого левого $\beta$-редекса.
\end{definition}

\begin{definition}[аппликативный порядок редукции]
	Редукция самого левого $\beta$-редекса из самых вложенных.
\end{definition}

\begin{statement}
	Если нормальная форма существует, она может быть достигнута нормальным порядком редукции.
\end{statement}